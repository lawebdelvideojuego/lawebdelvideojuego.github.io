<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title }} - {{ site.title }}</title>
  <meta name="description" content="{{ summary or site.description }}">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lora:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css">

  <!-- Open Graph -->
  <meta property="og:title" content="{{ title }}">
  <meta property="og:description" content="{{ summary or site.description }}">
  <meta property="og:type" content="{% if layout == 'post.njk' %}article{% else %}website{% endif %}">
  <meta property="og:url" content="{{ site.url }}{{ page.url }}">
  {% if image %}
  <meta property="og:image" content="{{ site.url }}{{ image | replace('/assets/images/', '/images/') }}">
  {% endif %}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="{% if image %}summary_large_image{% else %}summary{% endif %}">
  <meta name="twitter:title" content="{{ title }}">
  <meta name="twitter:description" content="{{ summary or site.description }}">
  {% if image %}
  <meta name="twitter:image" content="{{ site.url }}{{ image | replace('/assets/images/', '/images/') }}">
  {% endif %}

  <link rel="canonical" href="{{ site.url }}{{ page.url }}">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1 class="site-title">
        <a href="/">{{ site.title }}</a>
      </h1>
      <nav class="site-nav">
        <a href="/articulos/"{% if page.url == '/articulos/' %} aria-current="page"{% endif %}>Articulos</a>
        <a href="/analisis/"{% if page.url == '/analisis/' %} aria-current="page"{% endif %}>Analisis</a>
        <a href="/sobre/"{% if page.url == '/sobre/' %} aria-current="page"{% endif %}>Sobre</a>
      </nav>
    </div>
  </header>

  <main class="container">
    {{ content | safe }}
  </main>

  <footer class="site-footer">
    <div class="container">
      <div class="footer-content">
        <p>&copy; {{ site.author }}</p>
        <a href="/original/" class="easter-egg" title="Una web de otro tiempo...">
          <img src="/original/inicio/titulo.gif" alt="" width="88" height="37">
        </a>
        <p>
          <a href="https://jbilbo.com" target="_blank" rel="noopener">jbilbo.com</a>
          &middot;
          <a href="https://bsky.app/profile/{{ site.bluesky }}" target="_blank" rel="noopener">Bluesky</a>
          &middot;
          <a href="https://github.com/{{ site.github }}" target="_blank" rel="noopener">GitHub</a>
        </p>
      </div>
    </div>
  </footer>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox">
    <button class="lightbox__close" aria-label="Cerrar"></button>
    <button class="lightbox__nav lightbox__nav--prev" aria-label="Anterior"></button>
    <img class="lightbox__img" src="" alt="">
    <button class="lightbox__nav lightbox__nav--next" aria-label="Siguiente"></button>
  </div>

  <script>
    (function() {
      const lightbox = document.getElementById('lightbox');
      if (!lightbox) return;

      const img = lightbox.querySelector('.lightbox__img');
      const btnClose = lightbox.querySelector('.lightbox__close');
      const btnPrev = lightbox.querySelector('.lightbox__nav--prev');
      const btnNext = lightbox.querySelector('.lightbox__nav--next');

      let currentImages = [];
      let currentIndex = 0;

      function open(images, index) {
        currentImages = images;
        currentIndex = index;
        updateImage();
        lightbox.classList.add('is-active');
        document.body.style.overflow = 'hidden';
      }

      function close() {
        lightbox.classList.remove('is-active');
        document.body.style.overflow = '';
      }

      function updateImage() {
        img.src = currentImages[currentIndex];
        btnPrev.disabled = currentIndex === 0;
        btnNext.disabled = currentIndex === currentImages.length - 1;
      }

      function prev() {
        if (currentIndex > 0) {
          currentIndex--;
          updateImage();
        }
      }

      function next() {
        if (currentIndex < currentImages.length - 1) {
          currentIndex++;
          updateImage();
        }
      }

      // Event listeners
      document.querySelectorAll('.game-card__gallery img').forEach(function(galleryImg) {
        galleryImg.addEventListener('click', function() {
          const gallery = this.closest('.game-card__gallery');
          const images = Array.from(gallery.querySelectorAll('img')).map(function(i) { return i.src; });
          const index = images.indexOf(this.src);
          open(images, index);
        });
      });

      btnClose.addEventListener('click', close);
      btnPrev.addEventListener('click', prev);
      btnNext.addEventListener('click', next);

      lightbox.addEventListener('click', function(e) {
        if (e.target === lightbox) close();
      });

      document.addEventListener('keydown', function(e) {
        if (!lightbox.classList.contains('is-active')) return;
        if (e.key === 'Escape') close();
        if (e.key === 'ArrowLeft') prev();
        if (e.key === 'ArrowRight') next();
      });
    })();
  </script>
</body>
</html>
